# HarborX Platform

A modern platform for maritime operations, built with Next.js and FastAPI.

## Architecture

HarborX consists of three main services:

- **Web Service** (Next.js): Frontend application
- **Auth Service** (FastAPI): Authentication and authorization
- **Core Service** (FastAPI): Core business logic and API endpoints

## Prerequisites

### For Local Development
- Node.js 18+ and npm
- Python 3.11+
- PostgreSQL 14+
- Redis 7+

### For Render Deployment
- GitHub account
- Render account (free tier available)

## Local Development

### 1. Clone the Repository
```bash
git clone https://github.com/fahadalmusaad/harborx-platform.git
cd harborx-platform
```

### 2. Setup Web Service (Next.js)
```bash
cd web
npm install
cp .env.example .env.local
# Edit .env.local with your configuration
npm run dev
```

The web app will be available at http://localhost:3000

### 3. Setup Auth Service (FastAPI)
```bash
cd services/auth
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt
cp .env.example .env
# Edit .env with your configuration
python main.py
```

The auth service will be available at http://localhost:8001

### 4. Setup Core Service (FastAPI)
```bash
cd services/core
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt
cp .env.example .env
# Edit .env with your configuration
python main.py
```

The core service will be available at http://localhost:8000

### Health Checks
Verify all services are running:
- Web: http://localhost:3000/api/health
- Auth: http://localhost:8001/health
- Core: http://localhost:8000/health

## Deploy to Render

HarborX is configured for automatic deployment to Render using a Blueprint specification.

### Prerequisites
1. GitHub repository connected to Render
2. Render account (sign up at https://render.com)

### Deployment Steps

#### Option 1: Deploy with Blueprint (Recommended)

1. **Fork or Clone Repository**
   ```bash
   git clone https://github.com/fahadalmusaad/harborx-platform.git
   cd harborx-platform
   ```

2. **Connect to Render**
   - Go to https://dashboard.render.com
   - Click "New" → "Blueprint"
   - Connect your GitHub repository
   - Select the `harborx-platform` repository
   - Render will automatically detect `render.yaml`

3. **Configure Environment Variables**
   
   After the Blueprint is applied, set these environment variables in the Render dashboard:
   
   **harborx-web service:**
   - `NEXT_PUBLIC_API_URL`: Set to your core service URL (e.g., `https://harborx-core.onrender.com`)
   
   **harborx-auth service:**
   - `CORS_ORIGINS`: Set to your web service URL (e.g., `https://harborx-web.onrender.com`)
   - `JWT_SECRET_KEY`: Auto-generated by Render (no action needed)
   
   **harborx-core service:**
   - `CORS_ORIGINS`: Set to your web service URL (e.g., `https://harborx-web.onrender.com`)
   - `AUTH_SERVICE_URL`: Set to your auth service URL (e.g., `https://harborx-auth.onrender.com`)

4. **Deploy**
   - Click "Apply" to create all services
   - Render will provision:
     - 3 web services (web, auth, core)
     - 1 PostgreSQL database
     - 1 Redis instance
   - Wait for all services to build and deploy (5-10 minutes)

5. **Verify Deployment**
   
   Check health endpoints:
   - Web: `https://harborx-web.onrender.com/api/health`
   - Auth: `https://harborx-auth.onrender.com/health`
   - Core: `https://harborx-core.onrender.com/health`
   
   All should return `{"status": "healthy", ...}`

#### Option 2: Manual Service Creation

If you prefer manual setup:

1. Create PostgreSQL database: `harborx-postgres`
2. Create Redis instance: `harborx-redis`
3. Create three web services using the settings from `render.yaml`
4. Set environment variables as described above

### Auto-Deploy

Once connected, Render automatically deploys when you push to the `main` branch:

```bash
git add .
git commit -m "Update feature"
git push origin main
```

Render will:
1. Detect the push
2. Build each service
3. Run health checks
4. Deploy with zero downtime

### Environment Variables Strategy

#### Development vs Production

**Local Development** (`.env.example` → `.env`):
- Use example files as templates
- Store locally, never commit `.env` files
- Use localhost URLs

**Production** (Render Dashboard):
- All secrets managed in Render
- Auto-generated values for sensitive keys
- Auto-injected database URLs
- Service-to-service URLs set manually

#### Security Best Practices

✅ **DO:**
- Use Render's environment variables for all secrets
- Use `generateValue: true` for sensitive keys
- Use `.env.example` for documentation
- Add `.env*` to `.gitignore`

❌ **DON'T:**
- Commit `.env` files to repository
- Hard-code secrets in code
- Share secrets in logs or documentation
- Use default secrets in production

### Monitoring

**Health Checks:**
- All services expose `/health` endpoints
- Render monitors these automatically
- Failed health checks prevent deployment

**Logs:**
- Access via Render dashboard
- Real-time streaming available
- Search and filter capabilities

**Metrics:**
- CPU and memory usage in Render dashboard
- Request counts and response times
- Database connection metrics

### Rollback Strategy

If a deployment fails:

1. **Instant Rollback via Dashboard:**
   - Go to Render dashboard
   - Select the service
   - Click "Rollback" to previous version

2. **Git Revert:**
   ```bash
   git revert HEAD
   git push origin main
   ```

3. **Deploy Specific Commit:**
   - Use Render dashboard
   - "Manual Deploy" → select commit

### Troubleshooting

#### Services can't communicate
- **Problem**: Web can't reach API, or Core can't reach Auth
- **Solution**: Verify `NEXT_PUBLIC_API_URL`, `AUTH_SERVICE_URL` are set correctly in Render dashboard

#### Database connection errors
- **Problem**: `DATABASE_URL` not found or connection refused
- **Solution**: Ensure database is created and `fromDatabase` is configured in `render.yaml`

#### CORS errors
- **Problem**: Browser blocks API requests
- **Solution**: Set `CORS_ORIGINS` to include your web service URL

#### Health check failures
- **Problem**: Deployment stuck on "Deploying" status
- **Solution**: Check logs for errors, verify health endpoint returns 200 OK

#### Cold starts (Free Tier)
- **Problem**: First request after inactivity is slow
- **Solution**: Upgrade to paid plan or implement a ping service

## Project Structure

```
harborx-platform/
├── web/                      # Next.js frontend
│   ├── app/                  # Next.js 14 app directory
│   │   ├── api/health/       # Health check endpoint
│   │   ├── page.tsx          # Home page
│   │   └── layout.tsx        # Root layout
│   ├── .env.example          # Environment variables template
│   ├── next.config.js        # Next.js configuration
│   ├── package.json          # Node dependencies
│   └── tailwind.config.js    # Tailwind CSS config
│
├── services/
│   ├── auth/                 # FastAPI auth service
│   │   ├── main.py           # FastAPI app with health check
│   │   ├── requirements.txt  # Python dependencies
│   │   └── .env.example      # Environment variables template
│   │
│   └── core/                 # FastAPI core service
│       ├── main.py           # FastAPI app with health check
│       ├── requirements.txt  # Python dependencies
│       └── .env.example      # Environment variables template
│
├── docs/
│   └── adr/                  # Architecture Decision Records
│       └── 001-render-deployment-architecture.md
│
├── render.yaml               # Render Blueprint specification
└── README.md                 # This file
```

## Contributing

1. Create a feature branch: `git checkout -b feature/my-feature`
2. Make changes and commit: `git commit -am 'Add my feature'`
3. Push to branch: `git push origin feature/my-feature`
4. Create Pull Request

## Architecture Decisions

See [docs/adr/](docs/adr/) for architectural decision records:
- [ADR 001: Render Deployment Architecture](docs/adr/001-render-deployment-architecture.md)

## Security

- All secrets managed via Render environment variables
- No credentials committed to repository
- HTTPS enforced by Render
- JWT for authentication
- CORS configured per environment

## License

[Add your license here]

## Support

For issues and questions:
- GitHub Issues: https://github.com/fahadalmusaad/harborx-platform/issues
- Render Status: https://status.render.com/
